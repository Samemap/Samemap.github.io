<!DOCTYPE html><html><head><meta charset='utf-8'/><title>Samemap</title><meta name='viewport'content='initial-scale=1,maximum-scale=1,user-scalable=no'/><script src="https://libs.cartocdn.com/mapbox-gl/v1.13.0/mapbox-gl.js"></script><link href="https://libs.cartocdn.com/mapbox-gl/v1.13.0/mapbox-gl.css"rel="stylesheet"/><style>body{margin:0;padding:0;background-color:#0099db}#map{position:absolute;top:0;bottom:0;width:100%}</style></head><body><div id='map'></div><script>var style={'version':8,'sprite':'https://samemap-planet-tiles.oss-cn-beijing.aliyuncs.com/sprite','glyphs':'https://tiles.basemaps.cartocdn.com/fonts/{fontstack}/{range}.pbf','sources':{'planet':{'type':'vector','tiles':['https://samemap-planet-tiles.oss-cn-beijing.aliyuncs.com/{z}/{x}/{y}.pbf'],'minzoom':2,'maxzoom':12},},'layers':[{'id':'background','type':'background','paint':{'background-color':'#0099db'}},{'id':'coast','type':'fill','source':'planet','source-layer':'coast','paint':{'fill-pattern':'p21','fill-opacity':0.3}},{'id':'land','type':'fill','source':'planet','source-layer':'land','paint':{'fill-color':'#63c74d'}},{'id':'landuse_2258','type':'fill','source':'planet','source-layer':'landuse_2258','minzoom':12,'maxzoom':18,'layout':{},'paint':{'fill-pattern':['get','p']}},{'id':'landuse_6000','type':'fill','source':'planet','source-layer':'landuse_6000','minzoom':6,'maxzoom':12,'layout':{},'paint':{'fill-pattern':['get','p'],}},{'id':'landuse_36000','type':'fill','source':'planet','source-layer':'landuse_36000','minzoom':2,'maxzoom':6,'layout':{},'paint':{'fill-pattern':['get','p']}},{'id':'roadnet','type':'line','source':'planet','source-layer':'roadnet','layout':{'line-join':'round','line-cap':'round'},'paint':{'line-pattern':'p21','line-width':['interpolate',['exponential',1.2],['zoom'],4,2,12,6],'line-opacity':0.2}},{'id':'roadlabel','type':'symbol','source':'planet','source-layer':'roadnet','layout':{'text-field':'{name}','symbol-placement':'line','symbol-spacing':300,'symbol-avoid-edges':false,'text-size':10,'text-padding':2,'text-pitch-alignment':'map','text-rotation-alignment':'map','icon-pitch-alignment':'map','icon-rotation-alignment':'map','text-letter-spacing':0,'icon-text-fit':'both',},'paint':{'text-color':'#3e2731','text-halo-color':'#e2eef0','text-halo-width':1}},{'id':'decoration','type':'symbol','source':'planet','source-layer':'decoration','layout':{'text-padding':12,'text-field':'{name}','text-size':12,'icon-image':['get','d'],'icon-padding':12,'icon-offset':[16,5],'text-anchor':'right','icon-size':2,'text-max-width':8,'text-keep-upright':true,'text-offset':[0.2,0.2]},'paint':{'text-color':'#000','icon-color':'#fff','icon-translate-anchor':'map','text-halo-color':'#f2f5f8','text-halo-width':1}},{'id':'town','type':'symbol','source':'planet','source-layer':'town','layout':{'text-padding':10,'text-field':'{name}','text-size':13,'icon-image':['get','i'],'icon-padding':12,'icon-offset':[16,5],'text-anchor':'right','icon-size':1,'text-optional':true,'text-max-width':8,'text-keep-upright':true,'text-variable-anchor':['left','right','top','bottom','top-left','top-right','bottom-left','bottom-right'],'text-offset':[1,1],'symbol-sort-key':100,},'paint':{'text-color':'#000','icon-color':'#fff','icon-translate-anchor':'map','text-halo-color':'#f2f5f8','text-halo-width':1}}]};var map=new mapboxgl.Map({container:'map',center:[0,0],zoom:2.5,style:style,minZoom:2,maxZoom:18,hash:true,pitch:30,customAttribution:'© Samemap. Check-in anything you do.',localIdeographFontFamily:'sans-serif, "Noto Sans", "Noto Sans CJK SC", sans-serif'});var inited=false map.on('idle',()=>{if(!inited){var features=map.queryRenderedFeatures({layers:['town']})var gifs=['jump.gif','idle.gif','doing.gif']for(var i=0;i<3;i++){var el=document.createElement('div')el.style.background=`url(https:el.style.width='64px'el.style.height='64px'el.cursor='pointer'var random_feature=features[Math.floor(Math.random()*features.length)]var feature_name=random_feature.properties['name_zh-Hans']if(!feature_name){feature_name=random_feature.properties['name']}console.log(random_feature)new mapboxgl.Marker(el,{anchor:'bottom'}).setLngLat(random_feature.geometry.coordinates).setPopup(new mapboxgl.Popup({offset:56}).setHTML(`<h3>我正在看 ${feature_name}的事情`)).addTo(map)}}inited=true})map.on('load',()=>{})map.on('click',function(e){var features=map.queryRenderedFeatures(e.point,{layers:['town']})if(typeof map.getLayer('townFocus')!=='undefined'){map.removeLayer('townFocus')}if(typeof map.getLayer('roadFocus')!=='undefined'){map.removeLayer('roadFocus')map.removeLayer('roadlabelFocus')map.removeSource('roadFocus')}if(!features.length){return}var feature=features[0];var nid=feature.properties.nid fetch(`https:.then(res=>res.text()).then(text=>{var lines=text.split('n')var featureCollection={"type":"FeatureCollection","features":[]}var townNids=[]for(var i=0;i<lines.length;i++){var line=lines[i]if(line){var j=JSON.parse(lines[i])townNids.push(j.properties.start)townNids.push(j.properties.end)featureCollection.features.push(j)}}townNids=townNids.slice(0,60)console.log(townNids)map.addSource('roadFocus',{'type':'geojson','data':featureCollection})map.addLayer({'id':'roadFocus','type':'line','source':'roadFocus','layout':{'line-join':'round','line-cap':'round'},'paint':{'line-color':'#feae34','line-width':['interpolate',['exponential',1.2],['zoom'],4,4,12,8],'line-opacity':0.7}})map.addLayer({'id':'roadlabelFocus','type':'symbol','source':'roadFocus','layout':{'text-field':'{name}','symbol-placement':'line','symbol-spacing':300,'symbol-avoid-edges':false,'text-size':14,'text-padding':2,'text-pitch-alignment':'map','text-rotation-alignment':'map','icon-pitch-alignment':'map','icon-rotation-alignment':'map','text-letter-spacing':0,'icon-text-fit':'both',},'paint':{'text-color':'#000','text-halo-color':'#e2eef0','text-halo-width':3}})map.addLayer({'id':'townFocus','type':'symbol','source':'planet','source-layer':'town','layout':{'text-padding':10,'text-field':'{name}','text-size':15,'icon-image':['get','i'],'icon-padding':12,'text-anchor':'right','icon-size':1.7,'text-max-width':8,'text-keep-upright':true,'text-variable-anchor':['left','right','top','bottom','top-left','top-right','bottom-left','bottom-right'],'text-offset':[0.5,0],'symbol-sort-key':10000,},'paint':{'text-color':'#000','icon-color':'#fff','icon-translate-anchor':'map','text-halo-color':'#f2f5f8','text-halo-width':2}})map.setFilter('townFocus',['in','nid'].concat(townNids))map.flyTo({center:feature.geometry.coordinates,zoom:2})}).catch(err=>console.error(err))})</script></body></html>
